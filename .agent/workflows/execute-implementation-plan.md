---
description: 実装計画(Implementation Plan)に基づいてコードを実装・テストする
---

# 実装実行ワークフロー

このワークフローは、作成された実装計画書 (`.../plans/.../XXX.md`) に基づき、コーディングルールとテストルールを遵守して実装を行います。

## 1. 入力とルールの確認

1.  **入力ファイルの特定**:
    *   ユーザーが指定したファイル、または現在エディタで開いているファイルを「実装計画書」として扱います。
2.  **ルールの読み込み**:
    *   以下のルールファイルを読み込み、作業全体を通して遵守してください。
        *   `prompts/rules/coding-rules.md` (コーディングルール)
        *   `prompts/rules/testing-rules.md` (テスト実施ルール)

## 2. 実装の実行

1.  **計画の読み込み**:
    *   実装計画書の内容を読み、変更対象のファイルや具体的な変更内容を把握します。
    *   計画が複数ファイルに分割されている場合は、すべての計画ファイルを確認してください。
2.  **進捗の追跡**:
    *   実装計画書内のチェックボックス `[ ]` は、作業完了時に `[x]` に変更してください。
    *   進行中の項目は `[/]` に変更することで、現在の作業状況を明確にします。
    *   複数ファイルにまたがる計画の場合、各ファイルのチェックボックスも適切に更新してください。
3.  **コーディング**:
    *   計画書の手順に従ってコードを記述・修正します。
    *   **重要**: `coding-rules.md` に記載されたスタイルや設計原則を厳守してください。

## 3. テストと検証

### 3.1 テスト実施の順序

実装計画で定められた順序に従い、以下の順番でテストを実施します:

1.  **Build & Unit Test (必須)**:
    *   **全てのテストの前に**: まずプロジェクト全体をビルドし、単体テストを通過させる必要があります。これにより、統合テストが最新のバイナリとアセットに対して実行されることを保証します。
    *   **実行コマンド**:
        ```bash
        ./scripts/process/build.sh
        ```
    *   **重要**: このステップが失敗（Exit Code != 0）した場合、**絶対に**次のステップ（統合テスト）に進んではいけません。コードが壊れています。
2.  **統合テストの実施**:
    *   Step 1が成功した場合のみ、統合テストを実行します。
        *   統合テストファイルは `tests/kuniumi/` のフォルダに配置します。
    *   統合テストは actual 外部システム（LLM APIなど）との連携を確認するため、優先的に実施します。
    *   **重要**: テストスクリプト (`integration_test.sh`) の **終了コード (Exit Code)** を必ず確認してください。
        *   Exit Codeが `0` でない場合は、**絶対に** 次のステップに進んではいけません。
        *   エラーログを読み、原因を特定し、修正して再実行する「修正ループ」に入ってください。
3.  **その他のテスト**:
    *   必要に応じて、結合テストやパフォーマンステストなども行います。

### 3.2 修正と再テスト (Mandatory Fix Loop)

> [!CAUTION]
> **NEVER IGNORE FAILURES**: ビルドやテストの失敗（Exit Code != 0）を無視してタスクを完了させることは、プロジェクトへの破壊行為とみなされます。

1.  **テスト失敗時の対応 (The Fix Loop)**:
    *   テストやビルドが失敗した場合は、以下のループを**成功するまで**繰り返します：
        1.  **Read Logs**: エラーログ、スタックトレースを読み、失敗原因を特定する。
        2.  **Fix Code**: 原因を取り除くためにコードまたはテストを修正する。
        3.  **Retry**: 再度同じコマンドを実行する。
    *   「後で直す」は禁止です。その場で直してください。
    *   修正した内容は、実装計画書のチェックボックスや進捗状況に反映してください。
2.  **仕様書の更新**:
    *   実装計画に「既存仕様書の更新」が含まれている場合、実装完了後に該当する仕様書を更新します。
    *   更新内容が正確であることを確認してください。
