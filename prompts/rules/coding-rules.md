# コーディング規範 (Coding Rules)

本規範は、コードの記述スタイル、技術スタック、および実装上の制約を定め、コードの品質と保守性を確保することを目的とします。
本プロジェクト構成は `prompts/rules/folder_structure.md` に準拠します。

## 1. 使用する技術

- **言語**: Go (v1.21+)
- **ライブラリ** (推奨):
  - CLIフレームワーク: `spf13/cobra` / `spf13/viper`
  - Model Context Protocol: `modelcontextprotocol/go-sdk/mcp`
  - Testing: 標準 `testing` パッケージ + `testify`

## 2. ワークフローと開発プロセス

本プロジェクトは **Vibe Coding** スタイルを採用し、AIエージェントとの協働を前提とします。

1. **定型処理のスクリプト化**:
   ビルド、テスト、デプロイなどの操作は `scripts/` ディレクトリ配下にシェルスクリプトとして実装すること（例: `scripts/process/build.sh`, `scripts/process/integration_test.sh`）。これらは `--help` を実装し、AIが自律的に実行可能でなければならない。
   > [!IMPORTANT]
   > `npm run build`, `go build`, `go test` などの直接実行は、環境間の差異や成果物の配置不整合を招くため **禁止** します。必ず対応する `scripts/process/` 配下のスクリプトを使用してください。

2. **ワークフローによるオーケストレーション**:
   一連の作業手順（例: 修正→テスト→再テスト）は `.agent/workflows/` に定義し、定型化する。

3. **TDD (テスト駆動開発) の徹底**:
   開発は必ず以下のサイクルで進めること。
   1. **レッド**: 実装の前に、その機能の要件を満たすテストコード（Unit Test）を先に書く。この時点でテストは失敗する。
   2. **グリーン**: テストを通過させるための最小限の実装を行う。
   3. **リファクタリング**: テスト通過後、コードの品質を高めるためにリファクタリングを行う。
   *テストのない実装は原則として認めない。*

## 3. 実装上の共通ルール

### 3.1 コードの品質と保守性

*   **ファイル・関数の分割**: 単一のファイルまたは関数の行数が **800行** を超える場合、コードの可読性と保守性を確保するために、ファイルの分割や関数の抽出を積極的に検討すること。
*   **DRY原則の遵守**: 重複したロジックは共通関数やパッケージ (`pkg/`) へ抽出し、再利用性を高めること。
*   **利用していないコードの削除**: どこからも参照されず、利用されない変数、関数、コードは可能な限り削除してください。

### 3.2 コメントと言語設定

*   **コメントの言語**: ソースコード内のコメント（ドキュメントコメント、インラインコメント含む）はすべて **英語** で記述すること。日本語の使用は **禁止** とする。
    *   **理由**: プロジェクトの国際的な可読性を確保し、AIモデルが意図を正確に解釈できるようにするため。

## 4. テスト実装規約

### 4.1 テストの構成

*   **単体テスト (Unit Test)**:
    *   対象: `cmd/`, `internal/`, `pkg/` 内の各パッケージ。
    *   実行: `go test ./...` または `scripts/process/build.sh`。
    *   制約: **Fail Fast**。外部通信を行わず、モックを使用すること。
*   **統合テスト (Integration Test)**:
    *   対象: `tests/` ディレクトリ配下。
    *   実行: `scripts/process/integration_test.sh` (カテゴリ指定なし、または `kuniumi` 等のバックエンドカテゴリ指定)。
    *   制約: 実際のコンテナやAPIと通信を行う。

### 4.2 テスト自動化

*   PR作成前やコミット前には必ず `.agent/workflows/build-pipeline.md` に相当するフロー（Unit Test -> Build -> Integration Test）を実行し、品質を担保すること。

## 5. ロギングと通信処理

*   **統一ログシステムの使用**: 全てのログ出力は、標準の `log` パッケージを通じて行うこと。`fmt.Print`などを用いて、stdio/stderrへの直接出力は禁止とする。
*   **ログレベルの使い分け**: `Debug`, `Info`, `Warn`, `Error` を適切に使い分けること。

